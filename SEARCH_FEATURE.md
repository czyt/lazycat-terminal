# 终端搜索功能

## 概述

LazyCat Terminal 提供了强大的终端内文本搜索功能，可以快速查找终端输出中的关键字。

## 使用方法

### 打开搜索框

按 `Ctrl + Shift + F` 打开搜索框。

### 搜索框位置

搜索框出现在终端右上角，不会遮挡终端内容。

### 输入搜索关键字

- 搜索框自动获得焦点，可直接输入关键字
- 支持任意文本搜索
- 使用 VTE 的正则表达式搜索引擎

### 执行搜索

- **`Enter`**：向前搜索（查找下一个匹配项）
- **`Ctrl + Enter`**：反向搜索（查找上一个匹配项）

### 查找结果

- 匹配的文本会在终端中高亮显示
- 自动滚动到匹配位置
- 支持循环查找（wrap around）：到达末尾后从头开始

### 关闭搜索框

- 按 `Esc` 键关闭搜索框
- 焦点自动返回到触发搜索的 VTE 终端

## 搜索框样式

### 外观设计

- **宽度**：150px
- **高度**：自适应（min-height: 24px）
- **背景色**：与分屏分隔条相同（`rgba(17, 17, 17, opacity)`）
- **边框**：1px 分隔条颜色（默认深灰色 #111）
- **透明度**：与窗口透明度一致（默认 0.88）
- **圆角**：4px 圆角边框
- **内边距**：6px

### 输入框样式

- **背景**：透明
- **文字颜色**：VTE 前景色（默认绿色 #00cd00）
- **光标颜色**：VTE 前景色（绿色 #00cd00）
- **字体大小**：16px（比默认终端字体大）
- **最小高度**：24px
- **内边距**：4px 8px
- **边框**：无（由外层搜索框提供边框）
- **占位文本**："Search..."
- **无 focus 状态显示**：聚焦时无任何视觉变化

### 行为特性

- **打开时清空**：每次打开搜索框时，自动清空之前的搜索内容
- **自动聚焦**：打开时自动将焦点设置到输入框
- **不区分大小写**：搜索时忽略大小写差异
- **无焦点指示器**：没有蓝色边框或其他焦点状态视觉效果

## 使用场景

### 1. 查找错误信息

```bash
# 运行编译或测试命令
make test

# 按 Ctrl+Shift+F
# 输入 "error" 并按 Enter
# 快速定位到错误信息
```

### 2. 查找日志关键字

```bash
# 查看日志文件
tail -f /var/log/syslog

# 按 Ctrl+Shift+F
# 输入关键字（如 "WARNING"）
# 快速找到警告信息
```

### 3. 查找命令历史

```bash
# 显示命令历史
history

# 按 Ctrl+Shift+F
# 输入命令片段
# 快速找到之前执行的命令
```

### 4. 查找文件内容

```bash
# 查看文件
cat large_file.txt

# 按 Ctrl+Shift+F
# 输入关键字
# 快速定位到相关内容
```

## 技术实现

### VTE 搜索 API

使用 VTE 库提供的搜索功能：

- `vte_terminal_search_set_regex()` - 设置搜索正则表达式
- `vte_terminal_search_find_next()` - 查找下一个匹配
- `vte_terminal_search_find_previous()` - 查找上一个匹配
- `vte_terminal_search_set_wrap_around()` - 启用循环查找

### 搜索框组件

- 使用 `Gtk.Overlay` 实现浮动搜索框
- 搜索框位于右上角，不影响终端显示
- 使用 `Gtk.Entry` 作为输入控件
- 通过 CSS 自定义样式

### 键盘事件处理

- `Ctrl + Shift + F`：在 window.vala 中捕获，调用 tab.show_search_box()
- `Enter`：在 search_entry 的 key_pressed 事件中处理
- `Ctrl + Enter`：检测 Ctrl 修饰键，调用反向搜索
- `Esc`：关闭搜索框并返回焦点

## 注意事项

1. **搜索范围**：仅搜索当前聚焦的 VTE 终端
2. **不区分大小写**：搜索时自动忽略大小写差异（如 "error" 可以匹配 "ERROR"）
3. **正则表达式**：使用 VTE 的 PCRE2 搜索引擎
4. **循环查找**：到达末尾后自动从头开始
5. **多分屏**：只搜索当前活跃的终端，不跨终端搜索
6. **清空行为**：每次打开搜索框时自动清空之前的搜索内容

## 快捷键总结

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + Shift + F` | 打开搜索框 |
| `Enter` | 向前搜索（下一个） |
| `Ctrl + Enter` | 反向搜索（上一个） |
| `Esc` | 关闭搜索框 |

## 未来改进

可能的功能增强：

- [ ] 添加大小写不敏感选项
- [ ] 添加正则表达式模式开关
- [ ] 显示匹配计数（如 "3/10"）
- [ ] 搜索历史记录
- [ ] 全局搜索（跨所有标签）
